<!--
  @description       : 
  @author            : Hanyeong Choi
  @group             : 
  @last modified on  : 05-26-2025
  @last modified by  : Hanyeong Choi
  Modifications Log
  Ver   Date         Author          Modification
  1.0   11-06-2024   Hanyeong Choi   Initial Version
-->
<aura:component implements="force:hasRecordId,flexipage:availableForAllPageTypes,force:appHostable"
                controller="DN_SQController" 
                description="Edit Requested SQ Modal">

    <aura:attribute name="isLoading"        type="Boolean"  default="false" />
    <aura:attribute name="isSalesSQ"        type="Boolean"  default="false" />
    <aura:attribute name="isRndSQ"          type="Boolean"  default="false" />
    <aura:attribute name="isReviewCheck"    type="Boolean"  default="false" />
    <aura:attribute name="rowId"            type="String" />
    <aura:attribute name="objectName"       type="String"   default="RequestedSQ__c" />
    <aura:attribute name="language"         type="String"   default="" />
    <aura:attribute name="fieldList"        type="List"     default="[]" />
    <aura:attribute name="categoryValues"   type="List"     default="[]" />
    <aura:attribute name="fieldStatus"      type="Object"   default="{ 'Sales_SQ__c': false, 'rndSQ__c': false }" />

    <aura:handler name="init" value="{!this}" action="{!c.modalInit}" />
    <aura:registerEvent name="modalEvent" type="c.DN_HandlerEvent" />

    <section role="dialog" tabindex="-1" aria-modal="true" aria-labelledby="modal-heading-01" class="slds-modal slds-fade-in-open">
        <div class="slds-modal__container">

            <!-- ðŸš©Aura Header -->
            <div class="slds-modal__header">
                <h1 id="modal-heading-01" class="slds-modal__title slds-hyphenate" tabindex="-1">{!$Label.c.DNS_REQ_T_REQUESTEDSQ}</h1>
            </div>

            <!-- ðŸš©Aura Body -->
            <lightning:recordEditForm   aura:id="recordEditForm" 
                                        objectApiName="{! v.objectName }"
                                        recordId="{! v.rowId }"
                                        onsubmit="{! c.handleSubmit }"
                                        onsuccess="{! c.handleSuccess }" 
                                        onerror="{! c.handleError }">
                <lightning:messages />
                <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1">

                    <!-- Loading Spinner -->
                    <aura:if isTrue="{! v.isLoading }">
                        <lightning:spinner size="large" variant="brand" alternativeText="Loading" />
                    </aura:if>

                    <!-- Aura Layout -->
                    <div class="slds-form slds-align_absolute-center">


                        <!-- ðŸš© 1. SQ Information -->
                        <div class="section-header">
                            <h2 class="section-title">{!$Label.c.DNS_REQ_T_REQUESTEDSQSECTION}</h2>
                        </div>
                        <div class="section-container">

                            <aura:if isTrue="{! v.isReviewCheck }">
                                <div class="one-column">
                                    <lightning:inputField aura:id="recordField" fieldName="IsReview__c" />
                                </div>
                            </aura:if>
                            <div class="one-column">
                                <aura:if isTrue="{! OR(v.isRndSQ, v.isSalesSQ) }">
                                    <lightning:inputField aura:id="categoryField" fieldName="Category__c" onchange="{! c.handleChangeCategory }" disabled="true" />

                                    <aura:set attribute="else">
                                        <lightning:inputField aura:id="categoryField" fieldName="Category__c" onchange="{! c.handleChangeCategory }" />
                                    </aura:set>
                                </aura:if>
                            </div>
                            <div class="one-column slds-form-element slds-form-element_horizontal slds-is-editing">
                                <div class="label-wrap slds-form-element__label">
                                    <label>{!$Label.c.DNS_REQ_L_REQUESTEDSQNAME}</label>
                                    <lightning:helptext content="{!$Label.c.DNS_REQ_M_PLACEHOLDER}" />
                                </div>
                                
                                <div class="slds-form-element__control">
                                    <lightning:inputField aura:id="nameField" fieldName="Name" variant="label-hidden" />
                                </div>
                            </div>
                            
                            <div class="one-column">
                                <lightning:inputField aura:id="descriptionField" fieldName="Description__c" />
                            </div>


                            <aura:iteration items="{!v.fieldList}" var="field">
                                <aura:if isTrue="{! field == 'Price__c' }">
                                    <aura:if isTrue="{! v.isSalesSQ }">
                                        <div class="one-column">
                                            <lightning:inputField aura:id="recordField" fieldName="{! field }" disabled="true" />
                                        </div>
    
                                        <aura:set attribute="else">
                                            <div class="one-column">
                                                <lightning:inputField aura:id="recordField" fieldName="{! field }" />
                                            </div>
                                        </aura:set>
                                    </aura:if>
                                </aura:if>

                                <aura:if isTrue="{! field == 'rndSQ__c' }">
                                    <div class="one-column">
                                        <!-- <lightning:inputField aura:id="recordField" fieldName="{! field }" onchange="{! c.handleChangeSalesSQ }" disabled="{! OR(v.fieldStatus.rndSQ__c, v.fieldStatus.Sales_SQ__c) }" /> -->
                                        <lightning:inputField aura:id="recordField" fieldName="{! field }" onchange="{! c.handleChangeSalesSQ }" disabled="true" />
                                    </div>
                                </aura:if>

                                <aura:if isTrue="{! field == 'Sales_SQ__c' }">
                                    <div class="one-column">
                                        <!-- <lightning:inputField aura:id="recordField" fieldName="{! field }" onchange="{! c.handleChangeRndSQ }" disabled="{! OR(v.fieldStatus.rndSQ__c, v.fieldStatus.rndSQ__c) }" /> -->
                                        <lightning:inputField aura:id="recordField" fieldName="{! field }" onchange="{! c.handleChangeRndSQ }" disabled="true" />
                                    </div>
                                </aura:if>

                                <aura:if isTrue="{! AND(field != 'Price__c', AND(field != 'Sales_SQ__c', field != 'rndSQ__c')) }">
                                    <div class="one-column">
                                        <lightning:inputField aura:id="recordField" fieldName="{! field }" />
                                    </div>
                                </aura:if>
                            </aura:iteration>
                        </div>
                    </div>
                </div>
                
                    <!-- ðŸš©Aura Footer -->
                <div class="slds-modal__footer">
                    <lightning:button onclick="{! c.handleClickClose }" label="{!$Label.c.DNS_B_Cancel}" />
                    <lightning:button variant="brand" type="submit" label="{!$Label.c.DNS_B_Save}" />
                </div>
            </lightning:recordEditForm>
        </div>
    </section>

    <div class="slds-backdrop slds-backdrop_open" role="presentation"></div>
</aura:component>