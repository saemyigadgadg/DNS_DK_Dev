<!--
  @related           : DN_OrderChangeController
  @description       : 주문 수정 요청 버튼
  @author            : yeongju.yun
  @last modified on  : 2025-03-13
  @last modified by  : yeongju.yun 
  Modifications Log
  Ver   Date         Author        Modification
  1.0   2025-03-13   yeongju.yun   Initial Version
-->
<aura:component
    controller="DN_OrderChangeController" 
    implements="flexipage:availableForAllPageTypes,force:appHostable,force:hasRecordId,force:lightningQuickActionWithoutHeader,forceCommunity:availableForAllPageTypes">

    <aura:attribute type="Boolean" name="isLoading" default="true"/>
    <aura:attribute type="String"  name="helpText"/>
    <aura:attribute type="Map"     name="helpTextMap"/>

    <aura:handler name="init" value="{!this}" action="{!c.doInit}" />

    <aura:html tag="style">
        .slds-modal__container:has(.cDN_OrderChangeBtn) {
            width:100%;
            max-width: 42rem;
        }

        .slds-modal__content:has(.cDN_OrderChangeBtn) {
            height:auto !important;
            max-height:none !important;
            padding: 0;
            overflow-y: clip;
        }

        .forceChatterBasePublisher :not(.PHONE) .cuf-content:has(.cDN_OrderChangeBtn) {
            padding:0;
        }

        .runtime_platform_actionsQuickActionWrapper .quick-actions-panel:has(.cDN_OrderChangeBtn){
            overflow: hidden;
        }

        .modal-body:has(.cDN_OrderChangeBtn),
        .slds-modal__container:has(.cDN_OrderChangeBtn),
        .slds-modal__content:has(.cDN_OrderChangeBtn),
        .quick-actions-panel:has(.cDN_OrderChangeBtn){    
            overflow: visible !important;
		}
    </aura:html>

    <div class="order_change_modal">
        <lightning:recordEditForm
            aura:id="orderChangeForm"
            objectApiName="OrderChangeRequest__c"
            onsubmit="{!c.handleSubmit}"
            onsuccess="{!c.handleSuccess}"
            onload="{!c.handleLoad}"
            onerror="{!c.handleError}">

            <header class="slds-modal__header">
                <h2 class="slds-text-heading_medium slds-hyphenate">{!$Label.c.Order_Change_Request}</h2>
            </header>

            <div class="slds-modal__content modal_body_wrap">
                <aura:if isTrue="{!v.isLoading }">
                    <lightning:spinner size="medium" alternativeText="Loading" />
                </aura:if>

                <lightning:layout multipleRows="true">
                    <lightning:layoutItem padding="around-small" size="12">
                        <lightning:inputField fieldName="OrderChangeReason__c" required="true" variant="label-stacked" onchange="{!c.handleReason}"/>
                    </lightning:layoutItem>
                    <aura:if isTrue="{! !empty(v.helpText)}">
                        <lightning:layoutItem padding="around-small" size="12" class="help_text_style">
                           {!v.helpText}
                        </lightning:layoutItem>
                    </aura:if>
                    <lightning:layoutItem padding="around-small" size="12">
                        <lightning:inputField fieldName="ChangeDetail__c" variant="label-stacked"/>
                    </lightning:layoutItem>
                </lightning:layout>
            </div>

            <footer class="slds-modal__footer">
                <lightning:button variant="Neutral" label="{!$Label.c.DNS_B_Cancel}" onclick="{!c.closeClick}"/>
                <lightning:button variant="brand" label="{!$Label.c.DNS_B_Save}" type="submit"/>
            </footer>
        </lightning:recordEditForm>
    </div>
</aura:component>