<!--
  @description       : Ìè¨ÌÉà Î∂ÄÌíà - Ïò§Îçî ÏÉùÏÑ±
  @author            : youjin.shim@sbtglobal.com
  @group             : 
  @last modified on  : 2025-09-15
  @last modified by  : KyongyunJung@dkbmc.com
  Modifications Log
  Ver   Date         Author         Modification
  1.0   10-25-2024   yoiujin shim   Initial Version
-->
<aura:component
    implements="forceCommunity:availableForAllPageTypes,force:lightningquickactionwithoutheader,force:appHostable,flexipage:availableForAllPageTypes,flexipage:availableForRecordHome,force:hasRecordId,force:hasSObjectName,force:lightningQuickAction,lightning:isUrlAddressable,lightning:actionOverride,lightning:hasPageReference,lightning:availableForFlowScreens"
    controller="DN_PortalPartOrderCreateController" 
    access="global" 
    description="Ïò§ÎçîÏÉùÏÑ±">
    
    

    <!-- navigation -->
    <lightning:navigation aura:id="navOrderInquiry"/> <!--Ïò§ÎçîÏ°∞Ìöå ÌéòÏù¥ÏßÄÎ°ú Ïù¥Îèô-->

    <!--Attribute-->
    <aura:attribute name="isLoading"        type="Boolean" default="false" /> <!--Î°úÎî©-->
    <aura:attribute name="isPirce"          type="Boolean" default="false" /> <!--Í∞ÄÍ≤©Ï†ïÎ≥¥ Î™®Îã¨ Ïò§Ìîà-->
    <aura:attribute name="isError"          type="Boolean" default="false" /> <!--ÏóêÎü¨Î≥¥Í≥†ÏÑú Î™®Îã¨ Ïò§Ìîà-->
    <aura:attribute name="isTest"           type="Boolean" default="false" /> <!--Ïù∏ÌÑ∞ÌéòÏù¥Ïä§ ÌÖåÏä§Ìä∏-->
        
    <aura:attribute name="infoChangeModal"  type="Boolean" default="false" /> <!--Ï†ïÎ≥¥Î≥ÄÍ≤Ω Î™®Îã¨-->
    <aura:attribute name="costInfoModal"    type="Boolean" default="false" /> <!--Í∞ÄÍ≤©Ï†ïÎ≥¥ Î™®Îã¨-->
    <aura:attribute name="excelUploadModal" type="Boolean" default="false" /> <!--ÏóëÏÖÄ ÏóÖÎ°úÎìú Î™®Îã¨-->
    <aura:attribute name="isGPESModal"      type="Boolean" default="false" /> <!--GPES Î™®Îã¨-->
    <aura:attribute name="errorReportModal" type="Boolean" default="false" /> <!--ÏóêÎü¨Î≥¥Í≥†ÏÑú Î™®Îã¨-->
    
    <aura:attribute name="isBTN"            type="Boolean" default="true" description="Ï§ëÎ≥µÏÉùÏÑ± Î∞©ÏßÄ Í∏∞Îä•" /> 
    <aura:attribute name="isYDEO"           type="Boolean" default="false" description="Ïú†Ìòï Í∏¥Í∏âÎèÑ ÌôïÏù∏" />
    <aura:attribute name="isSave"           type="Boolean" default="false" description="Ï†ÄÏû• Ï†Ñ ÏãúÎÆ¨Î†àÏù¥ÏÖò ÏûëÎèô ÌôïÏù∏" />
    <aura:attribute name="isInit"           type="Boolean" default="true" description="ÏóëÏÖÄ Ï¥àÍ∏∞Ìôî Ïö©" />
    <aura:attribute name="isExcel"          type="Boolean" default="false" description="ÏóëÏÖÄ ÏûëÎèôÏãúÎßå true" />

    <aura:attribute name="dealerInfo"       type="Object" /> <!--Ï†ëÏÜçÏûê Ï†ïÎ≥¥-->
    <aura:attribute name="poName"           type="List" />
    <aura:attribute name="qtyArray"         type="List" />

    <!-- GPES Í¥ÄÎ†® ÏÜçÏÑ± -->
    <aura:attribute name="apexPageURL"      type="String" default="" /> <!--GPES Apex Page Url-->
    <aura:attribute name="receivedData"     type="List" /> <!--GEPS ÏóêÏÑú ÏÑ†ÌÉùÌïú Î∂ÄÌíàÏùò Ï†ïÎ≥¥(ÌíàÎ≤à, qty(ÏàòÎüâ), lotSize(Îã®ÏúÑ), salesPrice(Îã®Í∞Ä))-->
    <aura:attribute name="selectPartsNo"    type="List" /> <!--GPES ÏóêÏÑú ÏÑ†ÌÉùÌïú Î∂ÄÌíàÏùò Î≤àÌò∏(Îì§)-->
    <aura:attribute name="confirmParts"     type="List" /> <!--GPES ÏôÄ Product2 ÏùºÏπò ÌôïÏù∏Îêú Î∂ÄÌíà-->

    <aura:attribute name="partListLength"   type="String" />
    <aura:attribute name="partsList"        type="List" /> <!--ÏÑ†ÌÉùÌïú Î∂ÄÌíà Î†àÏΩîÎìú-->
    <aura:attribute name="initsList"        type="List" description="ÏóëÏÖÄ Ï¥àÍ∏∞ÌôîÏö©" />
    <aura:attribute name="partsInfo"        type="List" /> 
    <aura:attribute name="isSearched"       type="Boolean" default="false" />
    <aura:attribute name="orderItems"       type="List" default="[]" /> <!--Ïò§ÎçîÏ°∞Ìöå ÌÖåÏù¥Î∏î-->
    <aura:attribute name="orderTypeList"    type="List" /> <!--Ï£ºÎ¨∏ Ïú†Ìòï Picklist-->
    <aura:attribute name="options"          type="List" default="[
                                                                    {'label': 'Yes', 'value': 'Yes'},
                                                                    {'label': 'No' , 'value': 'No'}
                                                                ]" /> <!--ÏùºÍ¥ÑÎ∞∞ÏÜ°Ïó¨Î∂Ä-->

    <aura:attribute name="shipInfo"         type="List" /> <!--Î∞∞ÏÜ°Ï†ïÎ≥¥ List-->
    <aura:attribute name="costInfo"         type="Object"/> <!--Í∞ÄÍ≤©Ï†ïÎ≥¥ Î™®Îã¨ Í∞í--> 

    <!-- ÌûàÎì† ÏÜçÏÑ± -->
    <aura:attribute name="buyerInfo"        type="Object" /> <!--Î∂ÄÌíà Íµ¨Îß§Ìïú Í≥†Í∞ùÏÇ¨-->
    <aura:attribute name="managerInfo"      type="Object" />
    <aura:attribute name="machineInfo"      type="Object" />
    <aura:attribute name="machineRowNo"     type="Object" />
    <aura:attribute name="newPartOrderNo"   type="String" />
    <aura:attribute name="today"            type="String" />
    <aura:attribute name="checkList"        type="List" default="[]" description="ÏÇ≠Ï†úÌï† row Î™®Ïùå" />

    <!-- ÏÇ¨Ïö©Ïûê ÏûÖÎ†• Ïπ¥Îìú 01 -->
    <aura:attribute name="orderType"            type="String" default="YDOR" /> <!--Ï£ºÎ¨∏ Ïú†Ìòï-->
    <aura:attribute name="customerOrderNo"      type="String" /> <!--Í≥†Í∞ùÏ£ºÎ¨∏Î≤àÌò∏-->
    <aura:attribute name="consolidatedShipping" type="String" default="No" /> <!--ÏùºÍ¥ÑÎ∞∞ÏÜ°Ïó¨Î∂Ä-->
    <aura:attribute name="shippingLocation"     type="Object" /> <!--Î∞∞ÏÜ°Ï≤ò-->
    <aura:attribute name="inputShipTo"          type="String" /> <!--Î∞∞ÏÜ°Ï≤ò-->

    <!-- ÏÇ¨Ïö©Ïûê ÏûÖÎ†• Ïπ¥Îìú 02 = Î∞∞ÏÜ°Ï†ïÎ≥¥ -->
    <aura:attribute name="shippingInfo"           type="Object" /> <!--Î∞∞ÏÜ°Ï†ïÎ≥¥ obj-->

    <!-- ÏãúÎÆ¨Î†àÏù¥ÏÖòÏùÑ ÌÜµÌïú Í∞ÄÍ≤© Ï†ïÎ≥¥ -->
    <aura:attribute name="credit"     type="String" />
    <aura:attribute name="creditCurr" type="String" />
    <aura:attribute name="tAmount"    type="String" />
    <aura:attribute name="currency"   type="String" />

    <aura:attribute name="totalAmount" type="Integer" />
    <aura:attribute name="totalCredit" type="Integer" />

    <aura:attribute name="priceData"  type="List" default="[]" description="ÏãúÎÆ¨Î†àÏù¥ÏÖòÏùÑ ÏûëÎèôÌï¥Ïïº Í∞íÏù¥ Îì§Ïñ¥ ÏòµÎãàÎã§." />

    <aura:attribute name="errorList"  type="List" default="[]" description="ÏóêÎü¨ Î≥¥Í≥†ÏÑú ÎÇ¥Ïö©" />
    <aura:attribute name="errorCount" type="Integer" default="0"/> <!--ÏóêÎü¨Î≥¥Í≥†ÏÑú Í∞ØÏàò--> 

    <!-- parts Purchase List -->
    <aura:attribute name="selectedPartsIndex"   type="Integer" />
    <aura:attribute name="isDisabled"           type="Boolean" default="false" />
    <!-- <aura:attribute name="selectedProducts"   type="List" default="false" /> -->

    <!-- Î≤ÑÌäº - ÏóëÏÖÄ -->
    <aura:attribute name="excelData" type="List" />
    <aura:attribute name="columns" type="List" />
    <aura:attribute name="fileName" type="String" />

    <!-- Simulation -->
    <aura:attribute name="oDKey" type="String" />
    <aura:attribute name="simulstatus" type="String" />
    <aura:attribute name="showCustomToast" type="Boolean" default="false"/>

    <aura:html tag="style">.toastMessage.forceActionsText{white-space : pre-line !important;}</aura:html>
    <!-- Event -->
    <aura:registerEvent name="cmpEvent" type="c:DN_HandlerEvent" />
    <!-- Excel JS & Sheet JS -->
    <ltng:require
        scripts="{!join(',', $Resource.ExcelTest1 + '/exceljs.min.js', $Resource.SheetJS + '/xlsx-js-style-master/dist/xlsx.bundle.js')}" />



    <!--handler-->
    <aura:handler name="init" value="{!this}" action="{!c.doInit}" />
    <aura:handler name="cmpEvent" event="c:DN_HandlerEvent" action="{!c.handleCompEvent}" />

    <!--DNS2Ï∞®CRMÌîÑÎ°úÏ†ùÌä∏ Ï∂îÍ∞ÄÏÇ¨Ìï≠-->
    <aura:attribute name="isDNSA"        type="Boolean" default="false" /> <!--Ìï¥Ïô∏Î≤ïÏù∏Ïö©-->  
    <aura:attribute name="declaredValue" type="String" default="No" /> <!--declared Value-->
    <aura:attribute name="dOptions"      type="List" default="[{'label': 'Yes', 'value': 'Yes'}
                                                              ,{'label': 'No' , 'value': 'No'}]" /> <!--declared Value-->

    <article class="slds-card">
        <!--modal-->
        <div aura:id="AgencyCustomerShipToModal" /> <!--Î∞∞ÏÜ°Ï≤ò Î™®Îã¨-->
        <div aura:id="SearchProductNumber" /> <!--Î∂ÄÌíà Î™®Îã¨-->
        <div aura:id="ModelSearchModal" /> <!--Í∏∞Ï¢Ö/Ïû•ÎπÑÎ≤àÌò∏ Î™®Îã¨-->

        <!-- üö©Loading Spinner -->
        <aura:if isTrue="{! v.isLoading }">
            <lightning:spinner size="large" variant="brand" alternativeText="Loading" />
        </aura:if>

        <!-- üìå Header -->
        <header class="header">
            <div class="title">
                <lightning:icon iconName="standard:orders" size="small" alternativeText="Ïò§ÎçîÏÉùÏÑ±" />
                <h2>{!$Label.c.ORC_NewOrder}</h2> <!--Ïò§ÎçîÏÉùÏÑ±-->
            </div>

            <!-- button -->
            <div class="button-wrap">
                <lightning:button name="save" label="{!$Label.c.DNS_B_Save}" onclick="{!c.doSave}" variant="brand" disabled="{!v.isBTN}" 
                    iconName="utility:check" /><!--Ï†ÄÏû•-->
                <lightning:button name="back" label="Back" onclick="{!c.backPage}" variant="brand-outline"
                    iconName="utility:back" />
            </div>
        </header>

        <!-- üìå Body -->
        <div class="body">

            <!-- Card-01 -->
            <div class="{! v.isDNSA ? 'card-01A top-card' : 'card-01 top-card' }">
                <div class="field-wrap">
                    <p>{!$Label.c.DNS_C_OrderType}<abbr class="slds-required" title="required">*</abbr></p>  <!-- Ï£ºÎ¨∏Ïú†Ìòï -->
                    <div class="input-wrap">
                        <lightning:combobox name="orderType" value="{!v.orderType}" variant="label-hidden"
                            options="{!v.orderTypeList}" required="true" onchange="{!c.orderTypeChange}" disabled="{!c.isDNSA}" />
                    </div>
                </div>
                <div class="field-wrap">
                    <p>{!$Label.c.RC_CustomerOrderNumber}<abbr class="slds-required" title="required">*</abbr></p>  <!-- Í≥†Í∞ùÏ£ºÎ¨∏Î≤àÌò∏ -->
                    <div class="input-wrap">
                        <lightning:input name="customerOrderNo" aura:id="customerOrderNoId" variant="label-hidden"
                            required="true" value="{!v.customerOrderNo}" onchange="{!c.commonTypeChange}" />
                    </div>
                </div>
                <div class="field-wrap">
                    <p>{!$Label.c.ORC_ConsolidatedShipping}<abbr class="slds-required" title="required">*</abbr></p>  <!-- ÏùºÍ¥ÑÎ∞∞ÏÜ°Ïó¨Î∂Ä -->
                    <div class="input-wrap">
                        <lightning:radioGroup name="consolidatedShipping" variant="label-hidden" aura:id="batchDelivery"
                            options="{! v.options }" required="true" value="{! v.consolidatedShipping }"
                            onchange="{!c.commonTypeChange}" />
                    </div>
                </div>
                <!--DNSA Ï∂îÍ∞Ä ÏöîÏ≤≠ÏÇ¨Ìï≠ -->
                <aura:if isTrue="{!v.isDNSA}">
                    <div class="field-wrap">
                        <p>Declared Value</p>  <!--Ïã†Í≥†Í∞ÄÍ≤©ÌëúÏãúÏó¨Î∂Ä? -->
                        <div class="input-wrap">
                            <lightning:radioGroup name="declaredValue" variant="label-hidden" aura:id="declaredValue"
                                options="{! v.dOptions }" required="true" value="{! v.declaredValue }"
                                onchange="{!c.commonTypeChange}" />
                        </div>
                    </div>                        
                </aura:if>
                
                
                <div class="field-wrap ">
                    <p>{!$Label.c.ORC_ShippingAddress}<abbr class="slds-required" title="required">*</abbr></p>  <!-- Î∞∞ÏÜ°Ï≤ò -->
                    <div class="input-wrap address">
                        <lightning:input value="{!v.inputShipTo}" type="text" variant="label-hidden" required="true"
                            class="readonly-input" readonly="true" disabled="true" aura:id="inputShipToId" />
                        <lightning:buttonicon iconName="utility:search" size="medium" alternativeText="Search"
                            onclick="{!c.openCustomerShipTo}" />
                    </div>
                </div>
                
            </div>

            <!-- Card 02 -->
            <div class="card-02 top-card">
                <div class="card-header">
                    <h2>{!$Label.c.ORC_ShippingInformation}<abbr class="slds-required" title="required">*</abbr></h2>  <!-- Î∞∞ÏÜ°Ï†ïÎ≥¥ -->
                    <div class="button-wrap">
                        <lightning:button name="{!$Label.c.ORC_ChangeInformation}" label="{!$Label.c.ORC_ChangeInformation}" onclick="{!c.openInfoChangeModal}" 
                            iconName="utility:search" /><!-- Ï†ïÎ≥¥Î≥ÄÍ≤Ω-->
                    </div>
                </div>
                <div class="table-wrap">
                    <table>
                        <thead>
                            <tr>
                                <th>{!$Label.c.ORC_ShippingTerms}</th>   <!-- ÏÑ†Ï†ÅÏ°∞Í±¥ -->
                                <th>{!$Label.c.ORC_PaymentTerms}</th>   <!-- ÏßÄÍ∏âÏ°∞Í±¥ --> 
                                <th>{!$Label.c.ORC_TransportationCondition}1</th>  <!-- Ïö¥ÏÜ°Ï°∞Í±¥1 -->
                                <th>{!$Label.c.ORC_TransportationCondition}2</th>  <!-- Ïö¥ÏÜ°Ï°∞Í±¥2 -->
                            </tr>
                        </thead>
                        <tbody>
                            <td class="center">{!v.shippingInfo.shippingTerm}</td> 
                            <td class="center">{!v.shippingInfo.paymentTerm}</td>
                            <td class="center">{!v.shippingInfo.transportationTermOne}</td>
                            <td class="center">{!v.shippingInfo.transportationTermTwo}</td>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- card-03 -->
            <div class="card-03 top-card">
                <div class="card-header">
                    <div class="header-wrap">
                        <h2>Parts List</h2>  <!-- Ï¥ùÏï° -> Ï¥ù / Ïó¨Ïã† -->
                        <p>({!$Label.c.DNS_M_Total}: {!v.tAmount}&nbsp;{!v.currency} | {!$Label.c.ORC_Credit}: {!v.credit}&nbsp;{!v.creditCurr})</p>  <!-- Ï¥ùÏï° | Ïó¨Ïã†-->
                    </div>

                    <div class="button-wrap">
                        <lightning:button iconName="utility:ad_set" name="searchItems" label="GPES"
                        onclick="{!c.openGPES}" /> 
                        <lightning:button iconName="utility:add" name="searchItems" label="{!$Label.c.DNS_FSL_Add}"
                            onclick="{!c.bulkAddPartsProduct}" />  <!-- Ï∂îÍ∞Ä -->
                        <lightning:button iconName="utility:delete" name="searchItems" label="{!$Label.c.DNS_M_Delete}"
                            onclick="{!c.deleteRow}" />  <!-- ÏÇ≠Ï†ú -->
                        <lightning:button iconName="utility:refresh" name="searchItems" label="Simulation"
                            onclick="{!c.doSimulation}" /> 
                        <div>
                            <lightning:button iconName="utility:upload" name="searchItems" label="{!$Label.c.MPI_Upload}" 
                                onclick="{!c.openUploadExcel}" />  <!-- ÏóÖÎ°úÎìú -->
                            <!-- ÏóëÏÖÄ ÏóÖÎ°úÎìú -->
                            <aura:if isTrue="{!v.excelUploadModal}">
                                <div aura:id="excelModal" class="slds-modal pop-up-modal slds-fade-in-open excelModal">
                                    <div class="slds-modal__container slds-modal_large">
                                        <!-- Header -->
                                        <header class="slds-modal__header">
                                            <h2 class="slds-text-heading_medium">{!$Label.c.MPI_ExcelUpload}</h2>  <!-- ÏóëÏÖÄ ÏóÖÎ°úÎìú -->
                                            <!-- Close Button -->
                                            <button class="close_button_template slds-modal__close">
                                                <lightning:icon iconName='utility:close' alternativeText='close'
                                                    variant='inverse' size='small' title='close' name="closeModal"
                                                    onclick="{!c.closeUploadExcel}"></lightning:icon>
                                            </button>
                                        </header>
                                        <div class="modal-body slds-modal__content slds-p-around_medium">
                                            <div class="txt-box">
                                                <c:DN_DealerPortalExcelUploadTemplate buttonLabel="{!$Label.c.MPI_ExcelTemplateDown}" uploadName="PartsOrderCreateExcelUploadTemplate" />  <!-- ÏóÖÎ°úÎìú ÏñëÏãù Îã§Ïö¥Î°úÎìú -->
                                                <p>* Upload file form</p>
                                                <p>- Use header information.</p>
                                                <p>- {!$Label.c.ORC_MSG_1}</p> <!-- Ï£ºÎ¨∏ÌíàÎ≤àÍ≥º Ï£ºÎ¨∏ÏàòÎüâÏùÄ ÌïÑÏàò ÏûÖÎ†• Í∞í ÏûÖÎãàÎã§. -->
                                            </div>
                                            <div class="card-01 top-card">
                                                <lightning:input type="file" label="Upload Excel File"
                                                    onchange="{!c.uploadExcel}" accept=".xlsx, .xls" />
                                            </div>
                                        </div>
                                        <footer class="slds-modal__footer">
                                            <lightning:button variant="neutral" label="Cancel" title="Brand action"
                                                onclick="{!c.closeUploadExcel}" />
                                        </footer>
                                    </div>
                                </div>
                            </aura:if>
                        </div>
                        <lightning:button iconName="utility:download" name="searchItems" label="Download"
                            onclick="{!c.downloadExcel}" />
                        <div class="errorReport">
                            <aura:if isTrue="{!v.isError}">
                                <lightning:button iconName="utility:multi_picklist" name="searchItems" label="{!$Label.c.ORC_ErrorReport+'(' + v.errorCount + ')'}" onclick="{!c.openErrorReport}" />  <!-- ÏóêÎü¨ Î≥¥Í≥†ÏÑú --> 
                                <aura:set attribute="else">
                                    <lightning:button iconName="utility:multi_picklist" name="searchItems" label="{!$Label.c.ORC_ErrorReport}" disabled="true" onclick="{!c.openErrorReport}" />         <!-- ÏóêÎü¨ Î≥¥Í≥†ÏÑú -->                             
                                </aura:set>
                            </aura:if>
                            
                            <!-- ÏóêÎü¨Î≥¥Í≥†ÏÑú -->
                            <aura:if isTrue="{!v.errorReportModal}">
                                <div aura:id="errorReportModal" class="slds-modal pop-up-modal slds-fade-in-open errorReportModal">
                                    <div class="slds-modal__container slds-modal_large">
                                        <!-- Header -->
                                        <header class="slds-modal__header">
                                            <h2 class="slds-text-heading_medium">{!$Label.c.ORC_ErrorReport}</h2>  <!-- ÏóêÎü¨ Î≥¥Í≥†ÏÑú -->
                                            <!-- Close Button -->
                                            <button class="close_button_template slds-modal__close">
                                                <lightning:icon iconName='utility:close' alternativeText='close'
                                                    variant='inverse' size='small' title='close' name="closeModal"
                                                    onclick="{!c.closeErrorReport}"></lightning:icon>
                                            </button>
                                        </header>
                                        <div class="modal-body slds-modal__content slds-p-around_medium">
                                            <div class="card-01 top-card">
                                                <div class="table-wrap">
                                                    <table>
                                                        <thead>
                                                            <tr>
                                                                <th>{!$Label.c.service_lbl_part_no}</th>    <!-- Î∂ÄÌíàÎ≤àÌò∏ -->
                                                                <th>{!$Label.c.ORC_Duplication}</th>       <!-- Ï§ëÎ≥µ -->
                                                                <th>Wrong Item</th> 
                                                                <th>ÏûêÏû¨ÏóÜÏùå</th>    <!-- ÏûêÏû¨ÏóÜÏùå -->
                                                                <th>{!$Label.c.ORC_ProductGroup}</th>    <!-- Ï†úÌíàÍµ∞ -->
                                                                <th>{!$Label.c.DNS_M_Price}</th>         <!-- Í∞ÄÍ≤© -->
                                                                <th>{!$Label.c.ORC_NonPurchase}</th>     <!-- ÎπÑÍµ¨Îß§ -->
                                                                <th>{!$Label.c.ORC_NoCode}</th>          <!-- ÏΩîÎìú ÏóÜÏùå -->
                                                                <th>{!$Label.c.DNS_C_Details}</th>       <!-- ÎÇ¥Ïö© -->
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <aura:iteration items="{!v.errorList}" var="er">
                                                                <tr>
                                                                    <td>{!er.partName}</td>
                                                                    <td></td>
                                                                    <td>{!er.wrongItem}</td>
                                                                    <td>{!er.noMaterial}</td>
                                                                    <td>{!er.products}</td>
                                                                    <td>{!er.price}</td>
                                                                    <td>{!er.nonPurchased}</td>
                                                                    <td>{!er.noCode}</td>
                                                                    <td>{!er.message}</td>
                                                                </tr>
                                                            </aura:iteration>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                        <footer class="slds-modal__footer">
                                            <lightning:button variant="neutral" label="Cancel" title="Brand action"
                                                onclick="{!c.closeErrorReport}" />
                                        </footer>
                                    </div>
                                </div>
                            </aura:if>
                        </div>
                        <div>
                            <aura:if isTrue="{!v.isPirce}">
                                <lightning:button iconName="utility:moneybag" name="searchItems" label="{!$Label.c.DNS_T_Pricing}" onclick="{!c.openCostInfoModal}" />  <!-- Í∞ÄÍ≤©Ï†ïÎ≥¥ -->
                                <aura:set attribute="else">
                                    <lightning:button iconName="utility:moneybag" name="searchItems" label="{!$Label.c.DNS_T_Pricing}" disabled="true" onclick="" /> 
                                  </aura:set>
                            </aura:if>

                            <!-- Í∞ÄÍ≤©Ï†ïÎ≥¥ -->
                            <aura:if isTrue="{!v.costInfoModal}">
                                <div aura:id="costInfoModal" class="slds-modal pop-up-modal slds-fade-in-open cost-info-modal">
                                    <div class="slds-modal__container slds-modal_large">

                                        <!-- Header -->
                                        <header class="slds-modal__header">
                                            <h2 class="slds-text-heading_medium">{!$Label.c.DNS_T_Pricing}</h2>  <!-- Í∞ÄÍ≤©Ï†ïÎ≥¥ -->
                                            <!-- Close Button -->
                                            <button class="close_button_template slds-modal__close">
                                                <lightning:icon iconName='utility:close' alternativeText='close'
                                                    variant='inverse' size='small' title='close' name="closeModal"
                                                    onclick="{!c.closeCostInfoModal}"></lightning:icon>
                                            </button>
                                        </header>
                                        <div class="modal-body slds-modal__content slds-p-around_medium">
                                            <div class="card-01 top-card">
                                                <table
                                                    class="slds-table slds-table_cell-buffer slds-table_col-bordered IP-table">
                                                    <colgroup>
                                                        <col width="30%" />
                                                        <col width="20%" />
                                                        <col width="30%" />
                                                        <col width="20%" />
                                                    </colgroup>
                                                    <tr>
                                                        <th>Item Total(A)</th>
                                                        <td>{!v.costInfo.itemTotal}&nbsp;{!v.costInfo.priceCurrency}</td>
                                                        <th>Freight(B)</th>
                                                        <td>{!v.costInfo.freight}&nbsp;{!v.costInfo.priceCurrency}</td>
                                                    </tr>
                                                    <tr>
                                                        <th>Insurance(C)</th>
                                                        <td>{!v.costInfo.insurance}&nbsp;{!v.costInfo.priceCurrency}</td>
                                                        <th>Handling Charge(D)</th>
                                                        <td>{!v.costInfo.handlingCharge}&nbsp;{!v.costInfo.priceCurrency}</td>
                                                    </tr>
                                                    <tr>
                                                        <th>Output Tax(E)</th>
                                                        <td>{!v.costInfo.outputTax}&nbsp;{!v.costInfo.priceCurrency}</td>
                                                        <th>Total Amt(A+B+C+D+E)</th>
                                                        <td>{!v.costInfo.totalAmt}&nbsp;{!v.costInfo.priceCurrency}</td>
                                                    </tr>
                                                    <tr>
                                                        <th>Item Total(DNS) (A-F)</th>
                                                        <td>{!v.costInfo.itemTotalDoosan}&nbsp;{!v.costInfo.priceCurrency}</td>
                                                        <th>Commission Value(F)</th>
                                                        <td>{!v.costInfo.commissionValue}&nbsp;{!v.costInfo.priceCurrency}</td>
                                                    </tr>
                                                </table>
                                            </div>
                                        </div>
                                        <footer class="slds-modal__footer">
                                            <lightning:button variant="neutral" label="Cancel" title="Brand action"
                                                onclick="{!c.closeCostInfoModal}" />
                                        </footer>
                                    </div>
                                </div>
                            </aura:if>
                        </div>

                    </div>
                </div>
                <!-- <div>row : {!v.partListLength}</div> -->

                <div class="table-wrap">
                    <!--Table Left-->
                    <div class="table-01 left-table" aura:id="leftTableDiv">
                        <table aria-label="Example table of Opportunities with vertical borders">
                            <colgroup>
                                <!-- <col width="1%" /> -->
                                <col width="1%" />
                                <col width="8%" />
                                <col width="55%" />
                                <col width="35%" />
                            </colgroup>
                            <thead>
                                <tr>
                                    <!-- <th scope="col" class="add">
                                        <div class="input-wrap">
                                            <lightning:buttonIcon iconName="utility:add" alternativeText="Add"
                                                title="Add" size="small" onclick="{!c.addPartsProduct}" />
                                        </div>
                                    </th> -->
                                    <th scope="col" class="check-box">
                                        <lightning:input type="checkbox" aura:id="headerCheckbox"
                                            onchange="{! c.doCheckAll }" />
                                    </th>
                                    <th class="" scope="col">{!$Label.c.DNS_C_Item}</th>     <!-- Ìï≠Î™© -->
                                    <th class="" scope="col">{!$Label.c.ORC_OrderPartNumber}</th>  <!-- Ï£ºÎ¨∏ÌíàÎ≤à -->
                                    <th class="" scope="col">{!$Label.c.ORC_SupplyNumber}</th>  <!-- Í≥µÍ∏âÌíàÎ≤à -->
                                </tr>
                            </thead>
                            <tbody>
                                <aura:iteration items="{!v.partsList}" var="parts" indexVar="j">
                                    <tr>
                                        <!-- <td data-label="delete center">
                                            <div class="input-wrap">
                                                <aura:if isTrue="{!parts.isDisabled}">
                                                    <lightning:buttonIcon iconName="utility:dash" alternativeText="Dash" disabled="true" value="{!parts.orderPartNo}" aura:id="dashId"
                                                    title="Dash" size="small" accesskey="{!j}" />
                                                    <aura:set attribute="else">
                                                        <lightning:buttonIcon iconName="utility:dash" alternativeText="Dash" value="{!parts.orderPartNo}" aura:id="dashId"
                                                        title="Dash" size="small" accesskey="{!j}"
                                                        onclick="{!c.deletePartsProduct}" />    
                                                    </aura:set>
                                                </aura:if>
                                            </div>
                                        </td> -->
                                        <td class="check-box center">
                                            <aura:if isTrue="{!parts.isDisabled}">
                                                <lightning:input type="checkbox" aura:id="checkbox" value="{!parts.orderPartNo}" disabled="true" />
                                                <aura:set attribute="else">
                                                    <lightning:input type="checkbox" aura:id="checkbox" value="{!parts.orderPartNo}" accesskey="{!j}" 
                                                    onchange="{! c.doCheck }" />
                                                </aura:set>
                                            </aura:if>
                                        </td>
                                        <td data-label="Ìï≠Î™©" class="center" name="itemNo" aura:id="itemNoId">
                                            {!parts.hang}</td>
                                        <td data-label="Ï£ºÎ¨∏ÌíàÎ≤à">
                                            <div class="input-wrap order-product-number" title="Ï£ºÎ¨∏ÌíàÎ≤à">
                                                    <aura:if isTrue="{!parts.isDisabled}">
                                                        <lightning:input type="text" name="orderPartNo" variant="label-hidden" 
                                                        value="{!parts.orderPartNo}" aura:id="partNoId" disabled="true" />
                                                        <aura:set attribute="else">
                                                            <div accesskey="{!j}" onkeyup="{!c.handleKeyPress}" tabindex="0" >
                                                                <lightning:input type="text" name="orderPartNo" variant="label-hidden" 
                                                                value="{!parts.orderPartNo}" aura:id="partNoId" accesskey="{!j}"
                                                                onblur="{!c.orderPartsChange}" />
                                                                <lightning:buttonicon iconName="utility:close" size="medium" 
                                                                alternativeText="Close Product Number" onclick="{!c.clearOrderPart}" 
                                                                accesskey="{!j}" name="orderPartNo" class="clear-btn" />                                                            
                                                                <span
                                                                    class="slds-icon_container slds-icon-utility-search slds-input__icon slds-input__icon_right iconheight">
                                                                    <lightning:buttonicon iconName="utility:search" size="medium"
                                                                        alternativeText="Search" onclick="{!c.openSearchProductNumber}"
                                                                        accesskey="{!j}" />
                                                                </span>
                                                            </div>
                                                        </aura:set>
                                                    </aura:if>
                                            </div>
                                        </td>
                                        <td data-label="Í≥µÍ∏âÌíàÎ≤à" title="{!parts.supplyPartNo}">{!parts.supplyPartNo}</td>
                                    </tr>
                                </aura:iteration>
                            </tbody>
                        </table>
                    </div>

                    <!--Table Right-->
                    <div class="table-02 right-table" aura:id="rightTableDiv" onscroll="{!c.handleScroll}">
                        <table>
                            <thead>
                                <tr>
                                    <th>{!$Label.c.DNS_C_Item}</th>          <!-- ÌíàÎ™Ö -->
                                    <aura:if isTrue="{!v.isDNSA}">
                                            <!--Í∏¥Í∏âÎèÑ ÏÇ¨Ïö©ÏïàÌï® -->
                                    </aura:if>
                                    <aura:set attribute="else">
                                        <th>{!$Label.c.DNS_F_Urgency}</th>       <!-- Í∏¥Í∏âÎèÑ -->
                                    </aura:set>
                                    <th style="min-width:7rem;">{!$Label.c.ORC_OrderQuantity}</th>  <!-- Ï£ºÎ¨∏ÏàòÎüâ -->
                                    <th>{!$Label.c.ORC_SalesUnit}</th>    <!-- ÌåêÎß§Îã®ÏúÑ -->
                                    <th>{!$Label.c.DNS_FSL_Unit}</th>       <!-- Îã®ÏúÑ -->
                                    <th>{!$Label.c.ORC_NetPrice}</th>       <!-- Îã®Í∞Ä -->
                                    <th>{!$Label.c.ORC_ListPrice}</th>       <!-- Í∏àÏï° -->
                                    <th>{!$Label.c.DNS_C_Currency}</th>       <!-- ÌÜµÌôî -->
                                    <aura:if isTrue="{!v.isDNSA}">
                                        <th>DMTA_WH1</th>   <!--ÎØ∏Íµ≠_ÏãúÏπ¥Í≥†_Í∞ÄÏö©Ïû¨Í≥†-->
                                    </aura:if>
                                    <aura:set attribute="else">
                                        <th>HQ_WH1</th>     <!--Ï∞ΩÏõê_Í∞ÄÏö©Ïû¨Í≥†-->
                                        <th>HQ_WH2</th>     <!--Ï≤úÏïà_Í∞ÄÏö©Ïû¨Í≥†-->
                                    </aura:set>
                                    <!-- <th>Í∞ÄÏö©Ïû¨Í≥†</th> -->
                                    <th>TWP</th>         
                                    <th>Bulletin</th>
                                    <th>Note</th>
                                    <th>{!$Label.c.DNS_C_Model}</th>        <!-- Í∏∞Ï¢Ö -->
                                    <th>{!$Label.c.DNS_C_Equipment}</th>     <!-- Ïû•ÎπÑÎ≤àÌò∏ -->   
                                </tr>
                            </thead>
                            <tbody>
                                <aura:iteration items="{!v.partsList}" var="parts" indexVar="j">
                                    <tr>
                                        <td data-label="ÌíàÎ™Ö">{!parts.partName}</td>
                                        <aura:if isTrue="{!v.isDNSA}">
                                            <!--Í∏¥Í∏âÎèÑ ÏÇ¨Ïö©ÏïàÌï® -->
                                        </aura:if>
                                        <aura:set attribute="else">
                                            <td data-label="Í∏¥Í∏âÎèÑ" class="center">
                                                <div class="input-wrap">
                                                    <lightning:input name="urgency" type="checkbox" variant="label-hidden"
                                                        checked="{!parts.urgency}" onchange="{!c.urgencyCheck}"
                                                        accesskey="{!j}" />
                                                </div>
                                            </td>
                                        </aura:set>
                                        
                                        <td data-label="Ï£ºÎ¨∏ÏàòÎüâ">
                                            <div class="input-wrap" accesskey="{!j}" onkeyup="{!c.doEnter}">
                                                <aura:if isTrue="{!parts.isDisabled}">
                                                    <lightning:input name="quantity" type="text" aura:id="orderQtyId" variant="label-hidden" value="{!parts.quantity}"  accesskey="{!j}" disabled="true" />
                                                    <aura:set attribute="else">
                                                        <lightning:input name="quantity" type="text" aura:id="orderQtyId" variant="label-hidden" value="{!parts.quantity}"  accesskey="{!j}" onchange="{!c.orderPartsChange}" />
                                                    </aura:set>
                                                </aura:if>
                                                
                                            </div>
                                        </td>
                                        <td data-label="ÌåêÎß§Îã®ÏúÑ">{!parts.salesUnit}</td>
                                        <td data-label="Îã®ÏúÑ">{!parts.unit}</td>
                                        <td data-label="Îã®Í∞Ä" style="min-width: 5rem; text-align: right;">{!parts.unitPrice}</td>
                                        <td data-label="Í∏àÏï°">{!parts.partsAmount}</td>
                                        <td data-label="ÌÜµÌôî">{!parts.piCurrency}</td>
                                        <aura:if isTrue="{!v.isDNSA}">
                                            <td data-label="DMTA_WH1">{!parts.availableStock1}</td> <!--ÎØ∏Íµ≠ÏãúÏπ¥Í≥†-->
                                        </aura:if>
                                        <aura:set attribute="else">
                                            <td data-label="HQ_WH1">{!parts.availableStock1}</td><!--Ï∞ΩÏõêÍ∞ÄÏö©Ïû¨Í≥†-->
                                            <td data-label="HQ_WH2">{!parts.availableStock2}</td><!--Ï≤úÏïàÍ∞ÄÏö©Ïû¨Í≥†-->
                                        </aura:set>
                                        <!-- <td data-label="Í∞ÄÏö©Ïû¨Í≥†">{!parts.availableStock}</td> -->
                                        <td data-label="TWP">
                                            <div class="twp-icon center">
                                                <aura:if isTrue="{!not(empty(parts.twp))}">
                                                    <div data-partno="{!parts.orderPartNo}" data-type="twp" onclick="{!c.openGPESInUrl}">
                                                        <lightning:icon iconName="standard:attach" size="small"/>
                                                    </div>
                                                </aura:if>
                                            </div>
                                        </td>
                                        <td data-label="Bulletin">
                                            <div class="bulletin-icon center">
                                                <aura:if isTrue="{!not(empty(parts.bulletin))}">
                                                    <div data-partno="{!parts.orderPartNo}" data-type="bulletin" onclick="{!c.openGPESInUrl}">
                                                        <lightning:icon iconName="standard:attach" size="small"/>
                                                    </div>
                                                </aura:if>
                                            </div>
                                        </td>
                                        <td data-label="Note">
                                            <div class="note-icon center">
                                                <aura:if isTrue="{!not(empty(parts.note))}">
                                                    <div data-partno="{!parts.orderPartNo}" data-type="note" onclick="{!c.openGPESInUrl}">
                                                        <lightning:icon iconName="standard:attach" size="small"/>
                                                    </div>
                                                </aura:if>
                                            </div>
                                        </td>
                                        <td data-label="Í∏∞Ï¢Ö">
                                            <div class="input-wrap">
                                                <aura:if isTrue="{!parts.isDisabled}">
                                                    <lightning:input type="text" name="machine" value="{!parts.machine}"
                                                    variant="label-hidden" readonly="true" disabled="true" accesskey="{!j}"
                                                    aura:id="machineId" style="min-width:8rem;"/>                                                    
                                                    <aura:set attribute="else">
                                                        <lightning:input type="text" name="machine" value="{!parts.machine}" onchange="{!c.commonTypeChange}"
                                                        variant="label-hidden" accesskey="{!j}"
                                                        aura:id="machineId" style="min-width:8rem;"/>                                                        
                                                        <!-- <lightning:buttonicon iconName="utility:close" size="medium" 
                                                        alternativeText="Close Machine" onclick="{!c.clearField}" 
                                                        accesskey="{!j}" name="machine" class="clear-btn" />
                                                        <lightning:buttonicon iconName="utility:search" size="medium"
                                                            alternativeText="Search" accesskey="{!j}"
                                                            onclick="{!c.openMachineModal}" /> -->
                                                    </aura:set>
                                                </aura:if>
                                            </div>
                                        </td>
                                        <td data-label="Ïû•ÎπÑÎ≤àÌò∏">
                                            <div class="input-wrap">
                                                <aura:if isTrue="{!parts.isDisabled}">
                                                    <lightning:input type="text" name="equipment" value="{!parts.equipment}"
                                                    variant="label-hidden" readonly="true" disabled="true" accesskey="{!j}"
                                                    aura:id="equipmentId" style="min-width:8rem;"/>
                                                    <aura:set attribute="else">
                                                        <lightning:input type="text" name="equipment" value="{!parts.equipment}" onchange="{!c.commonTypeChange}"
                                                        variant="label-hidden" accesskey="{!j}"
                                                        aura:id="equipmentId" style="min-width:8rem;"/>
                                                        <!-- <lightning:buttonicon iconName="utility:close" size="medium" 
                                                        alternativeText="Close Equipment" onclick="{!c.clearField}" 
                                                    accesskey="{!j}" name="equipment" class="clear-btn" />
                                                        <lightning:buttonicon iconName="utility:search" size="medium"
                                                            alternativeText="Search" accesskey="{!j}"
                                                            onclick="{!c.openEquipmentModal}" /> -->
                                                    </aura:set>
                                                </aura:if>
                                            </div>
                                        </td>
                                    </tr>
                                </aura:iteration>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </article>


    <!-- Modal  -->
    <!-- Ï†ïÎ≥¥Î≥ÄÍ≤Ω-->
    <aura:if isTrue="{!v.infoChangeModal}">
        <div aura:id="infoChangeModal" class="slds-modal slds-fade-in-open">
            <div class="slds-modal__container slds-modal_large">

                <!-- Header -->
                <header class="slds-modal__header">
                    <h2 class="slds-text-heading_medium">{!$Label.c.ORC_ShippingInformation}</h2>   <!-- Î∞∞ÏÜ°Ï†ïÎ≥¥ -->
                    <!-- Close Button -->
                    <button class="close_button_template slds-modal__close">
                        <lightning:icon iconName='utility:close' alternativeText='close' variant='inverse' size='small'
                            title='close' name="closeModal" onclick="{!c.closeInfoChangeModal}"></lightning:icon>
                    </button>
                </header>

                <div class="modal-body slds-modal__content slds-p-around_medium">
                    <div class="card-01 top-card">
                        <table class="slds-table slds-table_cell-buffer slds-table_col-bordered IP-table">
                            <colgroup>
                                <col width="20%" />
                                <col width="50%" />
                                <col width="10%" />
                                <col width="20%" />
                            </colgroup>
                            <tr>
                                <th>{!$Label.c.ORC_ShippingTerms}</th>   <!-- ÏÑ†Ï†ÅÏ°∞Í±¥ -->
                                <th>{!$Label.c.ORC_PaymentTerms}</th>   <!-- ÏßÄÍ∏âÏ°∞Í±¥ --> 
                                <th>{!$Label.c.ORC_TransportationCondition}1</th>  <!-- Ïö¥ÏÜ°Ï°∞Í±¥1 -->
                                <th>{!$Label.c.ORC_TransportationCondition}2</th>  <!-- Ïö¥ÏÜ°Ï°∞Í±¥2 -->
                            </tr>
                            <aura:iteration items="{!v.shipInfo}" var="si" indexVar="j">
                                <tr class="slds-hint-parent" name="shipInfo" onclick="{!c.selectRow}"
                                    data-record="{!j}">
                                    <td>
                                        <div class="slds-truncate" title="Shipping Term">{!si.shippingTerm}</div>
                                    </td>
                                    <td>
                                        <div class="slds-truncate" title="Payment Term">{!si.paymentTerm}</div>
                                    </td>
                                    <td>
                                        <div class="slds-truncate" title="Transportation Term 1">
                                            {!si.transportationTermOne}</div>
                                    </td>
                                    <td>
                                        <div class="slds-truncate" title="Transportation Term 2">
                                            {!si.transportationTermTwo}</div>
                                    </td>
                                </tr>
                            </aura:iteration>
                        </table>
                    </div>
                </div>
                <footer class="slds-modal__footer">
                    <lightning:button variant="neutral" label="Cancel" title="Brand action"
                        onclick="{!c.closeInfoChangeModal}" />
                </footer>
            </div>
        </div>
        <!-- Î∞∞Í≤Ω -->
        <div aura:id="modalBackGround" class="slds-backdrop slds-backdrop_open"></div>
    </aura:if>

    <!-- GPES MODAL -->
    <aura:if isTrue="{!v.isGPESModal}">
        <section class="slds-modal slds-fade-in-open GPES-Modal" role="dialog">
            <div class="slds-modal__container">
                
                <header class="slds-modal__header">
                    <button class="slds-button slds-button_icon slds-button_icon-inverse slds-modal__close" title="Close" onclick="{!c.closeModal}">
                        <lightning:icon iconName="utility:close" alternativeText="close" size="small"></lightning:icon>
                        <span class="slds-assistive-text">{!$Label.c.DNS_B_Close}</span>  <!-- Îã´Í∏∞ -->
                    </button>
                    <h2 class="slds-text-heading_medium">GPES</h2>    
                </header>
                
                <div class="slds-modal__content slds-p-around_medium">

                    <div class="container" style="height: 100%;">
                        <iframe src="{!v.apexPageURL}" width="100%" height="100%"></iframe>

                        <lightning:formattedText value="{!v.formData}" />
                    </div>

                </div>
                
                <footer class="slds-modal__footer">
                    <button class="slds-button slds-button_neutral" onclick="{!c.closeModal}">Cancel</button>
                </footer>

            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open"></div>
    </aura:if>
    <aura:if isTrue="{!v.showCustomToast}">
        <div class="slds-notify slds-notify_toast slds-theme_info" role="status"
            style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 10000; padding: 20px;">
            <span class="slds-assistive-text">Info</span>
            <span class="slds-icon_container slds-icon-utility-info slds-m-right_small">
                <lightning:icon iconName="utility:info" alternativeText="info" size="small"/>
            </span>
            <div class="slds-notify__content">
                <h2 class="slds-text-heading_small">
                    <!-- ÌååÏùº ÏóÖÎ°úÎìú ÌõÑ ÏûêÎèôÏúºÎ°ú ÏãúÎÆ¨Î†àÏù¥ÏÖòÏùÑ ÏãúÏûëÌï©ÎãàÎã§. Í∑∏ÎèôÏïà Î≥∏ ÌôîÎ©¥ÏùÑ Ïú†ÏßÄÌï¥ Ï£ºÏãúÍ∏∞ Î∞îÎûçÎãàÎã§. ÏãúÎÆ¨Î†àÏù¥ÏÖò ÏôÑÎ£å ÌõÑ Ï†ÄÏû•Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠Ìï¥ Ï£ºÏÑ∏Ïöî. -->
                    {!$Label.c.ORC_MSG_2}
                </h2>
            </div>
        </div>
    </aura:if>
    
</aura:component>