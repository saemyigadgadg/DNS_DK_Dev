<!--
  @author            : Yu-Hyun Park
  @description       : 
   - Opportunity Excel Upload
   - DNSA Only
  @last modified on  : 02-03-2025
  @last modified by  : Hyerin Ro
  Modifications Log
  Ver   Date         Author                      Modification
  1.0   2024-12-23   yuhyun.park@sbtglobal.com   Initial Version
-->
<aura:component
    implements="forceCommunity:availableForAllPageTypes,force:lightningquickactionwithoutheader,force:appHostable,flexipage:availableForAllPageTypes,flexipage:availableForRecordHome,force:hasRecordId,force:hasSObjectName,force:lightningQuickAction,lightning:isUrlAddressable,lightning:actionOverride,lightning:hasPageReference,lightning:availableForFlowScreens"
    controller="DN_ImportOpportunityController" description="Excel Import for Opportunity">

    <!-- Excel JS & Sheet JS -->
    <ltng:require
        scripts="{!join(',', $Resource.ExcelTest1 + '/exceljs.min.js', $Resource.SheetJS + '/xlsx-js-style-master/dist/xlsx.bundle.js')}" />

    <!-- Attribute -->
    <aura:attribute name="isLoading" type="boolean" default="false" />
    <aura:attribute name="accept" type="String" default=".xls, .xlsx" />
    <aura:attribute name="isFileUpload" type="Boolean" default="false" />
    <aura:attribute name="fileName" type="String" default="fileName.xlsx" />
    <aura:attribute name="excelData" type="Object[]" />
    <aura:attribute name="expectedHeaders" type="List" />

    <!-- Handler -->
    <aura:handler name="init" value="{! this }" action="{! c.doInit }" />

    <!-- Toast Notification -->
    <lightning:notificationsLibrary aura:id="notifLib" />

    <div class="total-wrap">
        <div class="slds-modal__container">

            <!-- 📌 Header -->
            <header class="slds-modal__header">
                <h2 class="slds-text-heading_medium">Opportunity Excel Import</h2>
            </header>

            <!-- 📌 Body -->
            <div class="">
                <div class="slds-modal__content modal-body">
                    <!-- ⏳ Loading Spinner -->
                    <aura:if isTrue="{! v.isLoading}">
                        <lightning:spinner size="large" variant="brand" alternativeText="Loading" />
                    </aura:if>

                    <!-- Upload Files -->
                    <div class="card-wrap">
                        <div class="slds-form__row card-03 top-card">
                            <div class="slds-form__item" role="listitem">
                                <div class="slds-form-element slds-form-element_horizontal slds-is-editing">
                                    <label class="slds-form-element__label"
                                        for="horizontal-form-element-id-14">Upload</label>
                                    <div class="slds-form-element__control">
                                        <aura:if isTrue="{!not(v.isFileUpload)}">
                                            <lightning:input aura:id="excelBtn" type="file" variant="label-hidden"
                                                accept="{!v.accept}" multiple="false" onchange="{!c.handleUpload}" />
                                            <aura:set attribute="else">
                                                <div class="uploaded">
                                                    <div class="icon-wrap">
                                                        <lightning:icon iconName='doctype:excel' alternativeText='Excel'
                                                            size='Small' title='Excel'>
                                                        </lightning:icon>
                                                    </div>
                                                    <p class="file-name">{!v.fileName}</p>
                                                    <!-- 취소 아이콘 추가 -->
                                                    <div class="icon-wrap">
                                                        <lightning:icon iconName="utility:close"
                                                            alternativeText="Cancel" size="x-small" title="Cancel"
                                                            onclick="{!c.doCancel}" />
                                                    </div>
                                                </div>
                                            </aura:set>
                                        </aura:if>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 📌 Footer -->
                    <footer class="slds-modal__footer">
                        <lightning:button variant="neutral" label="Close" onclick="{!c.doClose}" />
                        <lightning:button variant="brand" label="Import" onclick="{!c.doImport}" />
                    </footer>
                </div>


            </div>

        </div>

        <!-- Modal Background -->
        <div id="modal-bg"></div>
    </div>

</aura:component>