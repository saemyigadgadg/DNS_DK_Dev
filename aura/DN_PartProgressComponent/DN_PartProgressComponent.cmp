<!--
  @author            : Yeong-Deok Seo
  @Description       : 
  @last modified on  : 04-02-2025
  @last modified by  : Hyerin Ro
  Modifications Log
  Ver   Date         Author                        Modification
  1.0   2024-11-11   yeongdeok.seo@sbtglobal.com   Initial Version
-->
<aura:component
    implements="forceCommunity:availableForAllPageTypes,force:lightningquickactionwithoutheader,force:appHostable,flexipage:availableForAllPageTypes,flexipage:availableForRecordHome,force:hasRecordId,force:hasSObjectName,force:lightningQuickAction,lightning:isUrlAddressable,lightning:actionOverride,lightning:hasPageReference,lightning:availableForFlowScreens"
    description="Î∂ÄÌíàÏßÑÌñâÏÉÅÌÉú" controller="DN_PartProgressController">

    <!-- attribute -->
    <aura:attribute name="isLoading" type="boolean" default="false" />
    <aura:attribute name="searchObject" type="DN_PartProgressController.SearchObject" />
    <aura:attribute name="searchStartDate" type="Date" />
    <aura:attribute name="searchEndDate" type="Date" />
    <aura:attribute name="searchOrderNumber" type="String" default="" />
    <aura:attribute name="statusOption" type="List" default="[
        {'label': 'Ï†ÑÏ≤¥', 'value': '0'},
        {'label': 'ÌôïÎ≥¥Ï§ë', 'value': '1'},
        {'label': 'Ïû¨Í≥†Î≥¥Ïú†', 'value': '2'},
        {'label': 'Ìè¨Ïû•ÏôÑÎ£å', 'value': '3'},
        {'label': 'Î∞∞ÏÜ°ÏôÑÎ£å', 'value': '4'}
    ]" />
    <aura:attribute name="searchStatus" type="String" default="0" />
    <aura:attribute name="searchPartName" type="String" default="" />
    <aura:attribute name="searchPartNumber" type="String" default="" />
    <aura:attribute name="searchCustomerName" type="String" default="" />
    <aura:attribute name="searchGijong" type="String" default="" />
    <aura:attribute name="searchHogi" type="String" default="" />
    <aura:attribute name="searchSerialNumber" type="String" default="" />
    <aura:attribute name="CNFCheck" type="boolean" default="false" />

    <!-- Modal attribute -->
    <aura:attribute name="isGijongModal" type="boolean" default="false" />
    <aura:attribute name="selectedIndex" type="Decimal" default="" />
    <aura:attribute name="searchGijongModal" type="String" default="" />
    <aura:attribute name="partList" type="List" default="[]" />
    <aura:attribute name="giJongList" type="List" default="[]" />
    <!-- Sheet JS -->
    <ltng:require scripts="{!$Resource.ExcelJS + '/unpkg/exceljs.min.js'}" afterScriptsLoaded="{!c.handleScriptsLoaded}" />

    <!-- handler -->
    <aura:handler name="init" value="{! this }" action="{! c.doInit }" />

    <aura:html tag="style">
        .navexDesktopLayoutContainer.desktop .viewport .stage.hasFixedFooter .slds-brand-band:not(.brand-band_magnetic):not(.brand-band_disabled)>.slds-template__container .oneContent:after {
            display: none !important
        }
    </aura:html>

    <!-- üöó Î∂ÄÌíàÏßÑÌñâÏÉÅÌÉú -->
    <div class="total-wrap">

        <article class="slds-card">

            <!-- Loading Spinner -->
            <aura:if isTrue="{! v.isLoading }">
                <lightning:spinner size="large" variant="brand" alternativeText="Loading..." />
            </aura:if>

            <!-- Header -->
            <div class="header">
                <div class="title slds-grid">
                    <lightning:icon iconName="standard:case_change_status" size="small"
                        alternativeText="Indicates approval" />
                    <h2 class="slds-truncate">Î∂ÄÌíàÏßÑÌñâÏÉÅÌÉú</h2>
                </div>
            </div>

            <!-- Body -->
            <div class="body">
                <div class="card-01">

                    <div class="field-wrap field-01">
                        <p>Ï†ëÏàòÏùºÏûê</p>
                        <div class="input-wrap">
                            <lightning:input type="Date" name="searchStartDate" value="{! v.searchObject.searchStartDate}"
                                variant="label-hidden" />
                            <span>~</span>
                            <lightning:input type="Date" name="searchEndDate" value="{! v.searchObject.searchEndDate}"
                                variant="label-hidden" />
                        </div>
                    </div>

                    <div class="field-wrap field-02">
                        <p>Ïò§ÎçîÎ≤àÌò∏</p>
                        <div class="input-wrap">
                            <lightning:input type="text" name="searchOrderNumber" variant="label-hidden"
                                value="{!v.searchObject.searchOrderNumber}" />
                        </div>
                    </div>

                    <div class="field-wrap field-03">
                        <p>ÏÉÅÌÉú</p>
                        <div class="input-wrap">
                            <lightning:combobox name="searchStatus" value="{!v.searchObject.searchStatus}"
                                options="{! v.statusOption }" variant="label-hidden" />
                        </div>
                    </div>

                    <div class="field-wrap field-04">
                        <p>ÌíàÎ™Ö</p>
                        <div class="input-wrap">
                            <lightning:input type="text" name="searchPartName" variant="label-hidden"
                                value="{!v.searchObject.searchPartName}" />
                        </div>
                    </div>

                    <div class="field-wrap field-05">
                        <p>ÌíàÎ≤à</p>
                        <div class="input-wrap">
                            <lightning:input type="text" name="searchPartNumber" variant="label-hidden"
                                value="{!v.searchObject.searchPartNumber}" />
                            <div class="button-wrap">
                                <lightning:button type="variant" name="searchButton" label="Ï°∞Ìöå"
                                    onclick="{!c.handleSearch}" />
                            </div>
                        </div>
                    </div>

                    <div class="field-wrap field-06">
                        <p>ÏóÖÏ≤¥Î™Ö</p>
                        <div class="input-wrap">
                            <lightning:input type="text" name="searchCustomerName" variant="label-hidden"
                                value="{!v.searchObject.searchCustomerName}" />
                        </div>
                    </div>
                    <div class="field-wrap field-07">
                        <p>Í∏∞Ï¢Ö</p>
                        <div class="input-wrap">
                            <lightning:input type="text" name="searchGijong" variant="label-hidden"
                                value="{!v.searchObject.searchGijong}" />
                            <lightning:buttonicon iconName="utility:search" size="medium" alternativeText="Search"
                                onclick="{!c.handleGijongModal}" /> 
                        </div>
                    </div>

                    <div class="field-wrap field-08">
                        <p>Ïû•ÎπÑÎ≤àÌò∏</p>
                        <div class="input-wrap">
                            <lightning:input type="text" name="searchHogi" variant="label-hidden"
                                value="{!v.searchObject.searchHogi}" />
                        </div>
                    </div>

                    <!-- <div class="field-wrap field-09">
                        <p>Ï†úÏ°∞Î≤àÌò∏</p>
                        <div class="input-wrap">
                            <lightning:input type="text" name="searchSerialNumber" variant="label-hidden"
                                value="{!v.searchObject.searchSerialNumber}" />
                        </div>
                    </div> -->

                    <div class="field-wrap field-10">
                        <p>CNF Ï†úÏô∏</p>
                        <div class="input-wrap">
                            <lightning:input type="checkbox" name="CNFCheck" variant="label-hidden"
                                checked="{!v.searchObject.CNFCheck}" />
                        </div>
                    </div>
                </div>

                <!-- Card 02 : Í≤ÄÏÉâ Í≤∞Í≥º ÌÖåÏù¥Î∏î -->
                <div class="card-02">
                    <div class="title slds-grid">
                        <div class="logo-title">
                            <lightning:icon iconName="standard:lead_list" size="x-small"
                                alternativeText="Indicates approval" />
                            <h2 class="slds-truncate">Î∂ÄÌíàÏßÑÌñâÏÉÅÌÉú Î¶¨Ïä§Ìä∏</h2>
                        </div>
                        <lightning:button class="slds-m-left_auto" iconName="doctype:excel" label="Excel" onclick="{!c.handleDownloadExcel}" />
                    </div>
                        <div class="table-wrap">
                        <table class="slds-table slds-table_cell-buffer slds-table_col-bordered IP-table"
                            aria-label="Example table of Opportunities with vertical borders">
                            <thead>
                                <tr class="slds-line-height_reset ">
                                    <th>
                                        <div class="slds-truncate" title="">Seq</div>
                                    </th>
                                    <th>
                                        <div class="slds-truncate" title="">ÌíàÎ≤à</div>
                                    </th>
                                    <th>
                                        <div class="slds-truncate" title="">ÌíàÎ™Ö</div>
                                    </th>
                                    <th>
                                        <div class="slds-truncate" title="">Ïò§ÎçîÏàò</div>
                                    </th>
                                    <th>
                                        <div class="slds-truncate" title="">Ïû¨Í≥†Ìï†Îãπ</div>
                                    </th>
                                    <th>
                                        <div class="slds-truncate" title="">Ìè¨Ïû•ÏôÑÎ£å</div>
                                    </th>
                                    <th>
                                        <div class="slds-truncate" title="">Î∞∞ÏÜ°ÏôÑÎ£å</div>
                                    </th>
                                    <th>
                                        <div class="slds-truncate" title="">ÏÉÅÌÉú</div>
                                    </th>
                                    <th>
                                        <div class="slds-truncate" title="">ÌÉÅÏÜ°Íµ¨Î∂Ñ</div>
                                    </th>
                                    <th>
                                        <div class="slds-truncate" title="">ÎÇ©Í∏∞Ïùº</div>
                                    </th>
                                    <th>
                                        <div class="slds-truncate" title="">ÎÇ©ÌíàÏóÖÏ≤¥</div>
                                    </th>
                                    <th>
                                        <div class="slds-truncate" title="">Î∂àÏ∂úÏùº</div>
                                    </th>
                                    <th>
                                        <div class="slds-truncate" title="">Î∞òÎÇ©ÎåÄÏÉÅ</div>
                                    </th>
                                    <th>
                                        <div class="slds-truncate" title="">Ïò§ÎçîÎ≤àÌò∏</div>
                                    </th>
                                    <th>
                                        <div class="slds-truncate" title="">Shipping Origin</div>
                                    </th>
                                    <th>
                                        <div class="slds-truncate" title="">SALES</div>
                                    </th>
                                    <th>
                                        <div class="slds-truncate" title="">ÏÜ°Ïû•Î≤àÌò∏</div>
                                    </th>
                                    <th>
                                        <div class="slds-truncate" title="">Ï∞ΩÍ≥†Î∂àÏ∂úÎ≤àÌò∏</div>
                                    </th>
                                    <th>
                                        <div class="slds-truncate" title="">Î∞∞ÏÜ°Ï≤ò</div>
                                    </th>
                                    <th>
                                        <div class="slds-truncate" title="">ÏóÖÏ≤¥Î™Ö</div>
                                    </th>
                                    <th>
                                        <div class="slds-truncate" title="">ÎåÄÎ¶¨Ï†êÏΩîÎìú</div>
                                    </th>
                                    <th>
                                        <div class="slds-truncate" title="">ÎåÄÎ¶¨Ï†êÎ™Ö</div>
                                    </th>
                                    <th>
                                        <div class="slds-truncate" title="">Í∏∞Ï¢Ö</div>
                                    </th>
                                    <th>
                                        <div class="slds-truncate" title="">Ïû•ÎπÑÎ≤àÌò∏</div>
                                    </th>
                                    <th>
                                        <div class="slds-truncate" title="">Ï†ëÏàòÏùº</div>
                                    </th>
                                    <th>
                                        <div class="slds-truncate" title="">Î∂ÄÌíàÏ≤≠Íµ¨Ïùº</div>
                                    </th>
                                    <th>
                                        <div class="slds-truncate" title="">ÏÑ§ÏπòÏùºÏûê</div>
                                    </th>
                                    <th>
                                        <div class="slds-truncate" title="">Shipment</div>
                                    </th>
                                    <th>
                                        <div class="slds-truncate" title="">D/O ÏÉùÏÑ±Ïùº</div>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <aura:iteration items="{!v.partList}" var="part" indexVar="i">
                                    <tr class="slds-hint-parent">
                                        <td>
                                            <div class="slds-truncate" title="">{!part.QMSEQ}</div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate" title="">{!part.MATNR}</div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate" title="">{!part.MAKTX}</div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate" title="">
                                                <lightning:formattedNumber value="{!part.KWMENG}" />
                                            </div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate" title="">
                                                <lightning:formattedNumber value="{!part.BMENG}" />
                                            </div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate" title="">
                                                <lightning:formattedNumber value="{!part.VSMNG}" />
                                            </div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate" title="">
                                                <lightning:formattedNumber value="{!part.GSMNG}" />
                                            </div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate" title="">{!part.MATNR_TXT}</div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate" title="">{!part.DIVISION}</div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate" title="">{!part.PRETD3}</div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate" title="">{!part.VNDNM}</div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate" title="">{!part.QDATU}</div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate" title="">{!part.RETURN_YN}</div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate" title="">{!part.AUFNR}</div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate" title="">{!part.VTEXT}</div> <!--ÏÜ°Î∂ÄÏ≤ò-->
                                        </td>
                                        <td>
                                            <div class="slds-truncate" title="">{!part.VBELN}</div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate" title="">{!part.INVOICE}</div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate" title="">{!part.VBELN_VL1}</div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate" title="">{!part.NAME4}</div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate" title="">{!part.NAME2}</div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate" title="">{!part.DEALER_CD}</div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate" title="">{!part.NAME1}</div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate" title="">{!part.TYPBZ}</div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate" title="">{!part.SERNR}</div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate" title="">{!part.RECV_DT}</div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate" title="">{!part.REQDATE}</div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate" title="">{!part.GWLDT}</div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate" title="">{!part.TKNUM}</div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate" title="">{!part.DODAT}</div>
                                        </td>
                                    </tr>
                                </aura:iteration>
                            </tbody>
                        </table>
                    </div>
                    <div>ROW : {!v.partList.length}</div>
                </div>
            </div>
        </article>
    </div>

    <!-- üöó Í∏∞Ï¢Ö ÏÑ†ÌÉù Î™®Îã¨ -->
    <aura:if isTrue="{!v.isGijongModal}">

        <div aura:id="basicInfoModal" class="slds-modal slds-fade-in-open">
            <div class="slds-modal__container">

                <!-- Modal Header -->
                <header class="slds-modal__header">
                    <h2 class="slds-text-heading_medium">Í∏∞Ï¢ÖÏÑ†ÌÉù</h2>
                </header>

                <!-- Modal Body -->
                <div class="modal-body slds-modal__content">

                    <!-- Loading Spinner -->
                    <aura:if isTrue="{! v.isLoading }">
                        <lightning:spinner size="large" variant="brand" alternativeText="Loading..." />
                    </aura:if>
                    
                    <div class="card-01">
                        <div class="field-wrap">
                            <p>Í∏∞Ï¢Ö</p>
                            <div class="input-wrap">
                                <lightning:input type="text" name="searchGijongModal" variant="label-hidden" value="{!v.searchGijongModal}" />
                                <div class="button-wrap">
                                    <lightning:button type="variant" name="searchButtonModal" label="Ï°∞Ìöå"
                                        onclick="{!c.handleSearchGijong}" />
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Card 02 : Í≤ÄÏÉâ Í≤∞Í≥º ÌÖåÏù¥Î∏î -->
                    <div class="card-02">
                        <div class="title">
                            <lightning:icon iconName="standard:lead_list" size="x-small"
                                alternativeText="Indicates approval" />
                            <h2 class="slds-truncate">Í∏∞Ï¢Ö Î¶¨Ïä§Ìä∏</h2>
                        </div>
                        <div class="table-wrap">
                            <table class="slds-table slds-table_cell-buffer slds-table_col-bordered IP-table"
                                aria-label="Example table of Opportunities with vertical borders">
                                <colgroup>
                                    <col width="8%" />
                                    <col width="46%" />
                                    <col width="46%" />
                                </colgroup>
                                <thead>
                                    <tr>
                                        <th>
                                            <div class="slds-truncate" title="">ÏÑ†ÌÉù</div>
                                        </th>
                                        <th>
                                            <div class="slds-truncate" title="">Material Number</div>
                                        </th>
                                        <th>
                                            <div class="slds-truncate" title="">Í∏∞Ï¢Ö</div>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <aura:iteration items="{!v.giJongList}" var="giJong" indexVar="i">
                                        <tr>
                                            <td>
                                                <div class="slds-truncate checkbox" title="">
                                                    <lightning:input type="checkbox" variant="label-hidden" name="{!i}"
                                                        aura:id="checkbox" onchange="{! c.handleCheckboxChange }" />
                                                </div>
                                            </td>
                                            <td>
                                                <div class="slds-truncate" title="">{!giJong.modelCode}</div>
                                            </td>
                                            <td>
                                                <div class="slds-truncate" title="">{!giJong.name}</div>
                                            </td>
                                        </tr>
                                    </aura:iteration>
                                </tbody>
                            </table>
                        </div>
                        <div>ROW : {!v.giJongList.length}</div>
                    </div>
                </div>

                <footer class="slds-modal__footer">
                    <lightning:button type="variant" name="selectButtonModal" label="ÏÑ†ÌÉù"
                        onclick="{!c.handleSelectGijong}" />
                    <lightning:button variant="neutral" label="Cancel" title="Brand action"
                        onclick="{!c.handleModalClose}" />
                </footer>
            </div>
        </div>

        <!-- Modal Background -->
        <div class="slds-backdrop slds-backdrop_open"></div>

    </aura:if>

</aura:component>